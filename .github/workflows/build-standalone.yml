name: Build Standalone Executable

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install wkhtmltopdf
        run: choco install wkhtmltopdf -y

      - name: Install Python dependencies
        run: pip install pyinstaller requests

      - name: Create standalone version info
        run: |
          $version = @'
# UTF-8
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(1,0,0,0),
    prodvers=(1,0,0,0),
    mask=0x3f,
    flags=0x0,
    OS=0x40004,
    fileType=0x1,
    subtype=0x0,
    date=(0, 0)
  ),
  kids=[
    StringFileInfo([
      StringTable('041103A4', [
        StringStruct('CompanyName', 'å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹ãƒ„ãƒ¼ãƒ«'),
        StringStruct('FileDescription', 'å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«'),
        StringStruct('FileVersion', '1.0.0.0'),
        StringStruct('InternalName', 'SyllabusPDFConverter'),
        StringStruct('LegalCopyright', 'MIT License'),
        StringStruct('OriginalFilename', 'å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«.exe'),
        StringStruct('ProductName', 'ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«'),
        StringStruct('ProductVersion', '1.0.0.0')
      ])
    ]),
    VarFileInfo([VarStruct('Translation', [1041, 932])])
  ]
)
'@
          $version | Out-File -FilePath "version_info.txt" -Encoding UTF8

      - name: Build standalone executable
        run: |
          pyinstaller --onefile --windowed `
            --name "å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«" `
            --version-file version_info.txt `
            --add-data "sample_course_codes.txt;." `
            --exclude-module matplotlib `
            --exclude-module numpy `
            --exclude-module scipy `
            --exclude-module pandas `
            --exclude-module PIL `
            --exclude-module tkinter.test `
            url_to_pdf_syllabus.py

      - name: Create installer package
        run: |
          # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
          New-Item -ItemType Directory -Force -Path "installer_package"

          # å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
          Copy-Item "dist\å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«.exe" "installer_package\"

          # ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
          Copy-Item "sample_course_codes.txt" "installer_package\"

          # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ä½œæˆ
          $guide = @'
# å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«

## ğŸ¯ ç‰¹å¾´
- âœ… Pythonã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦
- âœ… å®Œå…¨è‡ªç«‹å‹å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«
- âœ… ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã‚½ãƒ•ãƒˆèª¤æ¤œå‡ºãªã—
- âœ… å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹å°‚ç”¨

## ğŸ“‹ å¿…è¦ãªç’°å¢ƒ
- Windows 10/11 (64bit)
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š
- wkhtmltopdf (PDFå¤‰æ›ç”¨)

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. wkhtmltopdf ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…é ˆï¼‰
https://wkhtmltopdf.org/downloads.html ã‹ã‚‰ã€ŒWindows (MSVC 2015) 64-bitã€ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 2. ãƒ„ãƒ¼ãƒ«ã®é…ç½®
ã€Œå…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«.exeã€ã‚’ä»»æ„ã®ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æˆæ¥­ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆæº–å‚™
ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.txtï¼‰ã«1è¡Œ1æˆæ¥­ã‚³ãƒ¼ãƒ‰ã§è¨˜è¼‰ï¼š
```
ABC123
DEF456
GHI789
```

### 2. ãƒ„ãƒ¼ãƒ«èµ·å‹•
ã€Œå…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«.exeã€ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯

### 3. è¨­å®šãƒ»å¤‰æ›
- å¹´åº¦: å¯¾è±¡å¹´åº¦ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š2025ï¼‰
- æˆæ¥­ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: æº–å‚™ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
- PDFä¿å­˜å…ˆ: ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ
- ã€Œã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

## ğŸ“ ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
å„æˆæ¥­ã‚³ãƒ¼ãƒ‰ã«å¯¾å¿œã™ã‚‹PDFãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼šABC123.pdfï¼‰

## ğŸ”— ã‚·ãƒ©ãƒã‚¹URLå½¢å¼
https://syllabus.u-hyogo.ac.jp/slResult/[å¹´åº¦]/japanese/syllabusHtml/SyllabusHtml.[å¹´åº¦].[æˆæ¥­ã‚³ãƒ¼ãƒ‰].html

## ğŸ†˜ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã€Œwkhtmltopdf ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼: wkhtmltopdf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- PDFå¤‰æ›å¤±æ•—: æˆæ¥­ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ã€è©²å½“å¹´åº¦ã«ã‚·ãƒ©ãƒã‚¹ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
- å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ãªã„: Windows Defender ã®é™¤å¤–è¨­å®šã«è¿½åŠ 

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ
GitHub: https://github.com/KN-sci/url-to-pdf-converter
'@
          $guide | Out-File -FilePath "installer_package\ä½¿ç”¨æ–¹æ³•.txt" -Encoding UTF8

          # wkhtmltopdf ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ä½œæˆ
          $download_info = @'
# wkhtmltopdf ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹æ³•

## æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

1. ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
   https://wkhtmltopdf.org/downloads.html

2. ã€ŒWindows (MSVC 2015) 64-bitã€ã‚’é¸æŠ

3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ .exe ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ

4. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†å¾Œã€ã‚·ãƒ©ãƒã‚¹å¤‰æ›ãƒ„ãƒ¼ãƒ«ã‚’èµ·å‹•

## æ³¨æ„äº‹é …
- ç®¡ç†è€…æ¨©é™ã§ã®å®Ÿè¡ŒãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã« PC ã®å†èµ·å‹•ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™
'@
          $download_info | Out-File -FilePath "installer_package\wkhtmltopdf_ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•.txt" -Encoding UTF8

      - name: Create ZIP package
        run: |
          Compress-Archive -Path "installer_package\*" -DestinationPath "å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«_å®Œå…¨ç‰ˆ.zip"

      - name: Upload standalone package
        uses: actions/upload-artifact@v4
        with:
          name: å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«_å®Œå…¨ç‰ˆ
          path: |
            å…µåº«çœŒç«‹å¤§å­¦ã‚·ãƒ©ãƒã‚¹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«_å®Œå…¨ç‰ˆ.zip
            installer_package/*