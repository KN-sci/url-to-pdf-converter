name: Build Standalone Executable

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install wkhtmltopdf
        run: choco install wkhtmltopdf -y

      - name: Install Python dependencies
        run: pip install pyinstaller requests

      - name: Build standalone executable
        run: |
          pyinstaller --onefile --windowed --name "兵庫県立大学シラバスPDF変換ツール" url_to_pdf_syllabus.py

      - name: Create installer package
        run: |
          New-Item -ItemType Directory -Force -Path "installer_package"
          Copy-Item "dist\兵庫県立大学シラバスPDF変換ツール.exe" "installer_package\"
          Copy-Item "sample_course_codes.txt" "installer_package\"

      - name: Create documentation
        shell: pwsh
        run: |
          $guide = @"
# 兵庫県立大学シラバスPDF変換ツール

## 特徴
- Python環境不要の完全自立型実行ファイル
- 兵庫県立大学シラバス専用
- 年度指定機能付き

## 必要な環境
- Windows 10/11 (64bit)
- wkhtmltopdf
- インターネット接続

## wkhtmltopdf インストール方法
1. https://wkhtmltopdf.org/downloads.html にアクセス
2. Windows (MSVC 2015) 64-bit をダウンロード
3. ダウンロードしたファイルを実行してインストール

## 使用方法
1. 授業コードリスト.txt を準備（1行1授業コード）
2. 兵庫県立大学シラバスPDF変換ツール.exe を起動
3. 年度を入力
4. 授業コードリストファイルを選択
5. PDF保存先を選択
6. 変換開始ボタンをクリック

## URL形式
https://syllabus.u-hyogo.ac.jp/slResult/[年度]/japanese/syllabusHtml/SyllabusHtml.[年度].[授業コード].html
"@
          $guide | Out-File -FilePath "installer_package\使用方法.txt" -Encoding UTF8

      - name: Create ZIP package
        run: |
          Compress-Archive -Path "installer_package\*" -DestinationPath "兵庫県立大学シラバスPDF変換ツール_完全版.zip"

      - name: Upload standalone package
        uses: actions/upload-artifact@v4
        with:
          name: 兵庫県立大学シラバスPDF変換ツール_完全版
          path: 兵庫県立大学シラバスPDF変換ツール_完全版.zip